(e=>{const t=[],i=e=>{t.push(e)};i._last=[];const a=()=>{const e=t.shift()||i._last.shift();"function"==typeof e&&Promise.resolve(e()).then(a).catch(e=>console.error(e))};e.vic=i,e.addEventListener("DOMContentLoaded",a)})(window),vic.query=e=>document.querySelector(e),vic.queryAll=e=>Array.from(document.querySelectorAll(e)),vic.bytes=e=>1048576<=e?(e/1024/1024).toFixed(2)+" MB":1024<=e?(e/1024).toFixed(2)+" KB":`${e} BY`,vic.ago=(e,t)=>{var i=e=>`${e}`.padStart(2,"0");let a=(e-t)/1e3,r="";t=a/86400;1<t&&(t=Math.floor(t),a-=86400*t,r+=`${t}x24 `);let n=a/3600;1<n?(n=Math.floor(n),a-=3600*n):n=0,r+=i(n);let o=a/60;1<o?(o=Math.floor(o),a-=60*o):o=0,r+=":"+i(o);t=Math.floor(a);return r+=":"+i(t),r},vic._navFns=[],vic.appendNav=e=>vic._navFns.push(e),vic.getNav=()=>{let t=[];return vic._navFns&&vic._navFns.forEach(e=>{e=e(t);Array.isArray(e)&&(t=e)}),m("p.nav",t)},vic._routeFns=[],vic.appendRoute=e=>vic._routeFns.push(e),vic.getRoute=()=>{let t={};return vic._routeFns&&vic._routeFns.forEach(e=>{e=e(t);e&&(t=e)}),t},vic.confirm=()=>confirm("Are you sure you want to do it?"),vic.getLoading=()=>[vic.getNav(),m("div.loading","Loading")],vic.navItem=(e,t)=>{const i=m.route.get();var a=i===e||0===i.indexOf(e+"/");return m(m.route.Link,{href:e,class:a?"match":""},t)},vic.mSelect=(e,t,i)=>m("select",{name:e},i.map(e=>m("option",{value:e.value,selected:t===e.value},e.text))),vic.mTable=e=>{let t=[],i=0;return e.header&&0<e.header.length&&(i=e.header.length,t.push(m("tr",e.header.map(e=>m("th",[e]))))),e.rows&&0<e.rows.length&&(0===i&&(i=e.rows[0].length),t=t.concat(e.rows.map(e=>m("tr",e.map(e=>m("td",[e])))))),m(`table.cols${i}`,t)};const mSelectionList=(t,i,a,e)=>{e=e.map(e=>m("li",[m("input",{type:t,name:i,id:`rdo${i}${e.value}`,value:e.value,checked:a.includes(e.value)}),m("label",{for:`rdo${i}${e.value}`},e.text)]));return m("ul",e)};vic.mRadioList=(e,t,i)=>mSelectionList("radio",e,t,i),vic.mCheckList=(e,t,i)=>mSelectionList("checkbox",e,t,i);const HomeView=(()=>{const t={loading:!0,data:{}};return{oninit:()=>{t.loading=!0,m.request({method:"GET",url:"/status"}).then(e=>{t.loading=!1,t.data=e,m.redraw()})},view(){if(t.loading)return vic.getLoading();var e=t.data;return[vic.getNav(),m("h3","Home"),m("p",[vic.mTable({header:["Status",""],rows:[["Boot",vic.ago(e.millis,0)],["Reset Reason",e.resetReason],["Free Stack",vic.bytes(e.freeStack)],["Free Heap",vic.bytes(e.freeHeap)],["Max Free Block Size",vic.bytes(e.maxFreeBlockSize)],["Heap Fragmentation",e.heapFragmentation]]}),vic.mTable({header:["Hardware",""],rows:[["Chip ID",e.chipId],["CPU Freq",`${e.cupFreqMHz} MHz`],["Flash ID",e.flashId],["Flash Size",vic.bytes(e.flashSize)],["Flash Size (Real)",vic.bytes(e.flashSizeReal)],["Flash Speed",`${e.flashSpeedMHz} MHz`]]}),vic.mTable({header:["Software",""],rows:[["Sketch MD5",m("span.ellipsis",{title:e.sketchMD5},e.sketchMD5)],["Sketch Size",vic.bytes(e.sketchSize)],["Sketch Free Space",vic.bytes(e.sketchFreeSpace)],["SDK Version",e.sdkVersion],["Core Version",e.coreVersion],["Firmware Version",e.firmwareVersion]]})])]}}})(),FileSystemView=(()=>{const t={loading:!0,data:{}};return{oninit:()=>{t.loading=!0,m.request({method:"GET",url:"/fs"}).then(e=>{t.loading=!1,t.data=e,m.redraw()})},view(){if(t.loading)return vic.getLoading();var e=t.data;return[vic.getNav(),m("h3","File System"),m("p",[m(m.route.Link,{href:"/fs/files"},"Files")]),m("p",[vic.mTable({rows:[["Total",vic.bytes(e.totalBytes)],["Used",vic.bytes(e.usedBytes)],["Max Path Length",e.maxPathLength],["Max Open Files",e.maxOpenFiles],["Block Size",vic.bytes(e.blockSize)],["Page Size",vic.bytes(e.pageSize)]]})])]}}})(),FileListView=(()=>{const t={loading:!0,files:[]};return{oninit:()=>{t.loading=!0,m.request({method:"GET",url:"/files"}).then(e=>{t.loading=!1,t.files=e.files,m.redraw()})},view(){return t.loading?vic.getLoading():[vic.getNav(),m("h3","Files"),m("p",[m(m.route.Link,{href:"/fs"},"< FS")]),m("p",[vic.mTable({rows:t.files.map(({path:e,size:t})=>[m(m.route.Link,{href:m.buildPathname("/fs/files/:path",{path:e})},e),vic.bytes(t)])})])]}}})(),FileItemView=(()=>{const t={loading:!0,file:{name:"",size:0,content:""}},e=(e,t)=>{var i=m.route.param("path");return m.request({method:e,url:"/file",params:{path:i},body:t})},i=()=>{e("POST",{content:vic.query("textarea").value}).then(e=>{e.error?alert(e.error):r()})},a=()=>{vic.confirm()&&e("DELETE").then(e=>{e.error?alert(e.error):m.route.set("/fs/files")})},r=()=>{t.loading=!0,e("GET").then(e=>{t.file=e,t.loading=!1,m.redraw()})};return{oninit:r,view(){return t.loading?vic.getLoading():[vic.getNav(),m("h3",`${t.file.name} (${t.file.size} bytes)`),m("p",[m(m.route.Link,{href:"/fs/files"},"< Files")]),m("div.form",[m("p",[m("textarea",{cols:50,rows:10},t.file.content)]),m("p",[m("button.btn",{onclick:i},"Save"),m("button.btn.weak",{onclick:a},"Delete")])])]}}})(),WifiView=(()=>{const t={loading:!0,data:{}},i=()=>{t.loading=!0,m.request({method:"GET",url:"/wifi"}).then(e=>{t.loading=!1,t.data=e,m.redraw()})},a=()=>{var e=vic.query("input[type=radio]:checked");m.request({method:"POST",url:"/wifi/mode",body:{mode:e.value}}).then(()=>{i()})};return{oninit:i,view(){if(t.loading)return vic.getLoading();var e=t.data;return[vic.getNav(),m("h3","WiFi"),m("p",[m(m.route.Link,{href:"/wifi/list"},"Join Wifi")]),m("p",[vic.mTable({rows:[["Local Host",e.localHost?m("a",{href:`http://${e.localHost}.local`},e.localHost):""],["Mode",e.wifiMode],["Joined",e.joined||"-"],["STA IP",e.staAddress?m("a",{href:`http://${e.staAddress}`},e.staAddress):"-"],["STA MAC",e.staMacAddress],["AP IP",e.apAddress?m("a",{href:`http://${e.apAddress}`},e.apAddress):"-"],["AP MAC",e.apMacAddress]]})]),m("h3","WiFi Mode"),m("div.form",[vic.mRadioList("WifiMode",[e.wifiMode],[{value:"AP_STA",text:"AP+STA"},{value:"STA",text:"STA"},{value:"AP",text:"AP"},{value:"OFF",text:"OFF"}]),m("p",[m("button.btn",{onclick:a},"Submit")])])]}}})(),WifiListView=(()=>{const a={loading:!0,bssid:null,founds:[{bssid:"",ssid:"",channel:0,rssi:10}],password:""},e=()=>{a.password=vic.query("#txtPassword").value,i()},t=()=>{const t=vic.query("input[type=radio]:checked");var e,i;t?(e=vic.query("#txtPassword"),i=a.founds.find(e=>e.bssid===t.value),m.request({method:"POST",url:"/wifi/join",body:Object.assign({},{password:e.value},i)}).then(e=>{e.error?alert(e.error):e.ip&&alert("Success! obtain ip: "+e.ip),m.redraw()})):alert("Please select wifi to join")},i=()=>{a.loading=!0,m.request({method:"GET",url:"/wifi/list"}).then(e=>{a.loading=!1,Object.assign(a,e),m.redraw()})};return{oninit:i,view(){return a.loading?vic.getLoading():[vic.getNav(),m("h3","Join WiFi"),m("p",[m(m.route.Link,{href:"/wifi"},"< WiFi")]),m("div.form",[vic.mTable({rows:a.founds.map(e=>[m("input",{type:"radio",name:"bssid",id:e.bssid,value:e.bssid,checked:e.bssid===a.bssid}),m("label",{for:e.bssid},e.ssid),m("label",{for:e.bssid},e.bssid),m("label",{for:e.bssid},`${100+e.rssi}%`)])}),m("p",[m("label",{for:"txtPassword"},"Password"),m("input[type=text]",{id:"txtPassword",maxLength:32,value:a.password})]),m("p",[m("button.btn",{onclick:e},"Scan"),m("button.btn",{onclick:t},"Join")])])]}}})(),OtaView=(()=>{const t={loading:!0,data:{}},i=()=>{m.request({method:"POST",url:"/ota/fire",body:{version:"",otaType:""}}).then(e=>{e.error?alert(e.error):m.redraw()})};return{oninit:()=>{t.loading=!0,m.request({method:"GET",url:"/ota"}).then(e=>{t.loading=!1,t.data=e,m.redraw()})},view(){if(t.loading)return vic.getLoading();var e=t.data;return[vic.getNav(),m("h3","OTA"),e.overTheWeb?m("p",[m(m.route.Link,{href:"/ota/otw"},"Update - Over The Web")]):null,m("div.form",[m("p",[vic.mTable({rows:[["Flash Size",vic.bytes(e.flashSize)],["Flash Size (Real)",vic.bytes(e.flashSizeReal)],["Sketch Size",vic.bytes(e.sketchSize)],["Sketch Free Space",vic.bytes(e.sketchFreeSpace)],["Remote Latest",e.otaNewVersion],["Local Firmware",e.otaVersion]]})]),vic.mRadioList("OtaType",["sketch"],[{value:"all",text:"All"},{value:"sketch",text:"Sketch"},{value:"fs",text:"File System"}]),m("p",[m("button.btn",{onclick:i},"Load + Burn "+e.otaNewVersion)])])]}}})(),OtaOtwView={view(){return[vic.getNav(),m("h3","Over The Web"),m("p",[m(m.route.Link,{href:"/ota"},"< OTA")]),m("div.form",[m("iframe",{width:"100%",height:"300",frameborder:"0",scrolling:"no",marginHeight:"0",marginWidth:"0",src:"/update"})])]}},ResetView=(()=>{const e={loading:!0},t=()=>{var e=vic.queryAll("input[name=Reset]:checked").map(e=>e.value).join(",");m.request({method:"POST",url:"/reset",body:{values:e}}).then(e=>{e.error?alert(e.error):m.redraw()})};return{oninit:()=>{e.loading=!1},view(){return e.loading?vic.getLoading():[vic.getNav(),m("h3","Reset"),m("div.form",[vic.mCheckList("Reset",[],[{value:"EspRestart",text:"ESP Restart"},{value:"EspReset",text:"ESP Reset"},{value:"EspEraseCfg",text:"ESP Erase Config"},{value:"WifiReset",text:"Reset WiFi"}]),m("p",[m("button.btn",{onclick:t},"Submit")])])]}}})(),NotfoundView={view(){return"Oops... Notfound"}},RadioView=(()=>{const t={loading:!0,millis:0,inputPin:-1,lastReceived:{value:"",channel:0,timestamp:1}},e=()=>{var e=vic.query("#txtInputPin").value,t=vic.query("#txtOutputPin").value;m.request({method:"POST",url:"/radio",body:{inputPin:e,outputPin:t}}).then(e=>{e.error?alert(e.error):i()})},i=()=>{t.loading=!0,m.request({method:"GET",url:"/radio"}).then(e=>{t.loading=!1,t.millis=e.millis,t.inputPin=e.inputPin,t.outputPin=e.outputPin,t.lastReceived=e.lastReceived,m.redraw()})};return{oninit:i,view(){return t.loading?vic.getLoading():[vic.getNav(),m("h3","Radio"),m("p",[m(m.route.Link,{href:"/radio/emit"},"Emits"),m("span"," | "),m(m.route.Link,{href:"/radio/rule"},"Rules"),m("span"," | "),m(m.route.Link,{href:"/radio/command"},"Commands")]),vic.mTable({header:null,rows:[["Last Received",t.lastReceived.value?vic.ago(t.millis,t.lastReceived.timestamp)+" ago":"-"],["Value",t.lastReceived.value||"-"],["Channel",t.lastReceived.value?t.lastReceived.channel:"-"]]}),m("div.form",[m("p",[m("label",{for:"txtInputPin"},"Input Pin"),m("input[type=number]",{id:"txtInputPin",min:-1,max:100,value:t.inputPin})]),m("p",[m("label",{for:"txtOutputPin"},"Output Pin"),m("input[type=number]",{id:"txtOutputPin",min:-1,max:100,value:t.outputPin})]),m("p",[m("button.btn",{onclick:e},"Save")])])]}}})(),RadioEmitView=(()=>{const i={loading:!0,emits:[{name:"",value:"",channel:0,press:1}],lastReceived:{value:"",channel:0},pressOptions:[[1,"Click"],[2,"Double Click"],[3,"Long Press"]]},e=()=>{i.emits.push({name:"",value:i.lastReceived.value,channel:i.lastReceived.channel,press:i.pressOptions[0][0]}),m.redraw()},a=e=>{vic.confirm()&&(e=parseInt(e.target.value,10),i.emits.splice(e,1),m.redraw())},t=()=>{const e=vic.queryAll("input[name=Name]"),i=vic.queryAll("input[name=Value]"),a=vic.queryAll("input[name=Channel]"),r=vic.queryAll("select[name=PressId]");var t=e.map((e,t)=>({name:e.value,value:i[t].value,channel:a[t].value,press:r[t].value}));m.request({method:"POST",url:"/radio/emit",body:{emits:t}}).then(e=>{e.error?alert(e.error):n()})},r=e=>{i.loading=!0;e=parseInt(e.target.value,10);m.request({method:"POST",url:"/radio/emit/send",body:{index:e}}).then(e=>{e.error&&alert(e.error),i.loading=!1,m.redraw()})},n=()=>{i.loading=!0,m.request({method:"GET",url:"/radio/emit"}).then(e=>{i.loading=!1,i.emits=e.emits,i.lastReceived=e.lastReceived,m.redraw()})};return{oninit:n,view(){return i.loading?vic.getLoading():[vic.getNav(),m("h3","Radio Emits"),m("p",[m(m.route.Link,{href:"/radio"},"< Radio")]),m("div.form",[vic.mTable({header:["","","Name","Value","Channel","Press"],rows:i.emits.map((e,t)=>[m("button.btn.weak",{name:"Remove",value:t,onclick:a},"Remove"),m("button.btn",{name:"Send",value:t,onclick:r},"Send"),m("input[type=text]",{name:"Name",value:e.name,maxLength:8,style:{width:"40px"}}),m("input[type=text]",{name:"Value",value:e.value,maxLength:8,style:{width:"60px"}}),m("input[type=number]",{name:"Channel",value:e.channel,min:-1,max:100}),vic.mSelect("PressId",e.press,i.pressOptions.map(e=>({value:e[0],text:e[1]})))])}),m("p",[m("button.btn",{onclick:e},"Add+"),m("button.btn",{onclick:t},"Save")])])]}}})(),RadioRuleView=(()=>{const i={loading:!0,rules:[{value:"",channel:0,press:1,action:1,serviceId:""}],lastReceived:{value:"",channel:0},pressOptions:[[1,"Click"],[2,"Double Click"],[3,"Long Press"]],actionOptions:[[0,"None"],[1,"True"],[2,"False"],[3,"Toggle"],[4,"WiFi STA"],[5,"WiFi STA+AP"],[6,"WiFi Reset"],[7,"ESP Restart"]]},e=()=>{i.rules.push({value:i.lastReceived.value,channel:i.lastReceived.channel,press:i.pressOptions[0][0],action:i.actionOptions[0][0],serviceId:""}),m.redraw()},a=e=>{vic.confirm()&&(e=parseInt(e.target.value,10),i.rules.splice(e,1),m.redraw())},t=()=>{const e=vic.queryAll("input[name=Value]"),i=vic.queryAll("input[name=Channel]"),a=vic.queryAll("select[name=PressId]"),r=vic.queryAll("select[name=ActionId]"),n=vic.queryAll("select[name=ServiceId]");var t=e.map((e,t)=>({value:e.value,channel:i[t].value,press:a[t].value,action:r[t].value,serviceId:n[t].value}));m.request({method:"POST",url:"/radio/rule",body:{rules:t}}).then(e=>{e.error?alert(e.error):o()})},o=()=>{i.loading=!0,m.request({method:"GET",url:"/radio/rule"}).then(e=>{i.loading=!1,i.rules=e.rules,i.lastReceived=e.lastReceived,m.redraw()})};return{oninit:o,view(){return i.loading?vic.getLoading():[vic.getNav(),m("h3","Radio Rules"),m("p",[m(m.route.Link,{href:"/radio"},"< Radio")]),m("div.form",[vic.mTable({header:["","Value","Channel","Press","Action","Service"],rows:i.rules.map((e,t)=>[m("button.btn.weak",{name:"Remove",value:t,onclick:a},"Remove"),m("input[type=text]",{name:"Value",value:e.value,maxLength:8,style:{width:"60px"}}),m("input[type=number]",{name:"Channel",value:e.channel,min:-1,max:100}),vic.mSelect("PressId",e.press,i.pressOptions.map(e=>({value:e[0],text:e[1]}))),vic.mSelect("ActionId",e.action,i.actionOptions.map(e=>({value:e[0],text:e[1]}))),m("input[type=text]",{name:"ServiceId",value:e.serviceId,maxLength:8,style:{width:"60px"}})])}),m("p",[m("button.btn",{onclick:e},"Add+"),m("button.btn",{onclick:t},"Save")])])]}}})(),RadioCommandView=(()=>{const i={loading:!0,commands:[{entry:1,action:1,press:1,serviceId:""}],entryActionOptions:[["0-0","None"],["1-1","wifi-join"],["1-2","wifi-mode"],["1-3","wifi-reset"],["2-1","app-name"],["2-2","app-ota"],["3-1","esp-restart"],["4-1","boolean-set"],["4-2","boolean-toggle"]],pressOptions:[[1,"Click"],[2,"Double Click"],[3,"Long Press"]]},e=()=>{var e=i.entryActionOptions[0][0].split("-");i.commands.push({entry:e[0],action:e[1],press:i.pressOptions[0][0],serviceId:""}),m.redraw()},a=e=>{vic.confirm()&&(e=parseInt(e.target.value,10),i.commands.splice(e,1),m.redraw())},t=()=>{const e=vic.queryAll("select[name=EntryAction]"),i=vic.queryAll("select[name=PressId]"),a=vic.queryAll("select[name=ServiceId]");var t=e.map((e,t)=>{e=e.value.split("-");return{entry:e[0],action:e[1],press:i[t].value,serviceId:a[t].value}});m.request({method:"POST",url:"/radio/command",body:{commands:t}}).then(e=>{e.error?alert(e.error):r()})},r=()=>{i.loading=!0,m.request({method:"GET",url:"/radio/command"}).then(e=>{i.loading=!1,i.commands=e.commands,m.redraw()})};return{oninit:r,view(){return i.loading?vic.getLoading():[vic.getNav(),m("h3","Radio Commands"),m("p",[m(m.route.Link,{href:"/radio"},"< Radio")]),m("div.form",[vic.mTable({header:["","Entry","Press","Service"],rows:i.commands.map((e,t)=>[m("button.btn.weak",{name:"Remove",value:t,onclick:a},"Remove"),vic.mSelect("EntryAction",e.entry+"-"+e.action,i.entryActionOptions.map(e=>({value:e[0],text:e[1]}))),vic.mSelect("PressId",e.press,i.pressOptions.map(e=>({value:e[0],text:e[1]}))),m("input[type=text]",{name:"ServiceId",value:e.serviceId,maxLength:8,style:{width:"60px"}})])}),m("p",[m("button.btn",{onclick:e},"Add+"),m("button.btn",{onclick:t},"Save")])])]}}})();vic.appendNav(e=>e.concat([vic.navItem("/","Home"),m("span"," | "),vic.navItem("/wifi","WiFi"),m("span"," | "),vic.navItem("/fs","FS"),m("span"," | "),vic.navItem("/ota","OTA"),m("span"," | "),vic.navItem("/reset","Reset"),m("span"," | "),vic.navItem("/radio","Radio")])),vic.appendRoute(e=>Object.assign(e,{"/":HomeView,"/wifi":WifiView,"/wifi/list":WifiListView,"/fs":FileSystemView,"/fs/files":FileListView,"/fs/files/:path":FileItemView,"/ota":OtaView,"/ota/otw":OtaOtwView,"/reset":ResetView,"/404":NotfoundView,"/radio":RadioView,"/radio/emit":RadioEmitView,"/radio/rule":RadioRuleView,"/radio/command":RadioCommandView})),vic(()=>{var e=vic.query("div.main");m.route(e,"/",vic.getRoute())});